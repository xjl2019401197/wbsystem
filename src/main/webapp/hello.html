<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>pagination-nick</title>
    <style>
        button {
            padding: 5px;
            margin: 5px;
        }

        .active-nick {
            color: red;
        }

        input {
            width: 50px;
            text-align: center;
        }
    </style>
</head>
<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeInRight" id="app">
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox">
                <div class="ibox-title">
                    <h5>
                        <i class="fa fa-user"></i><span class="nav-label">会员管理</span>
                    </h5>
                    <div class="ibox-search">
                        <form class="form-inline" method="get" action="##"
                              id="form1">
                            <div class="input-group">
                                <input type="text" id="level2" name="level2"
                                       v-model="level2" placeholder="请输入会员等级"
                                       class="input-sm form-control"> <span
                                    class="input-group-btn">
                                     <input type="text" id="phone2" name="phone2"
                                            v-model="phone2" placeholder="电话号码"
                                            class="input-sm form-control"></span> <span
                                    class="input-group-btn">
                                     <input type="text" id="sex2" name="sex2"
                                            v-model="sex2" placeholder="性别"
                                            class="input-sm form-control"> </span><span
                                    class="input-group-btn">
										<button type="button" @click="search()" class="btn btn-sm btn-success">
											Search</button>
									</span>
                            </div>
                        </form>
                    </div>
                    <div class="ibox-tools">
                        <button type="button" class="btn btn-sm btn-success">
                            <a href="/project/download.do" download="文件名.txt">download</a>
                        </button>
                        <a class="collapse-link btn-xs"><span
                                class="glyphicon-chevron-up glyphicon" aria-hidden="true"></span></a>
                        <a class="btn-xs" @click="add()" href="javascript:void(0)">
                            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered table-hover table_center">
                            <thead>
                            <tr>
                                <th>会员手机号</th>
                                <th>会员类型</th>
                                <th>会员等级</th>
                                <th>性别</th>
                                <th>剩余金额</th>
                                <th v-if="user.type == 1">操作</th>
                                <th v-if="user.type == 1">操作</th>
                                <th v-if="user.type == 1">充值</th>
                                <th v-if="user.type == 1">退费</th>
                            </tr>
                            </thead>
                            <tbody id="tbody">
                            <tr v-for="(item , index)  in projectList" @click="details(item.cardId)">
                                <td>
                                    {{item.phone}}
                                </td>
                                <td>
                                    {{item.cardType == 0? '会员卡':'临时卡'}}
                                </td>
                                <td>
                                    {{item.level}}
                                </td>

                                <td>
                                    {{item.sex== 0? '女':'男'}}
                                </td>
                                <td>
                                    {{item.residueMoney}}
                                </td>
                                <td v-if="user.type != 1">
                                    <button type="button" @click="kaiji(item)" class="btn btn-warning">
                                        {{item.state== 0? '上机':'下机'}}
                                    </button>
                                </td>
                                <td v-if="user.type != 1">
                                    <button type="button" @click="del(item.cardId)" class="btn btn-danger">删除
                                    </button>
                                </td>
                                <td v-if="user.type != 1">
                                    <button type="button" @click="topUp(item.cardId)" class="btn btn-danger">充值
                                    </button>
                                </td>
                                <td v-if="user.type != 1">
                                    <button type="button" @click="refund(item)" class="btn btn-danger">退费
                                    </button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <!--                    <div class="row">${pageResult.pageHtml}</div>-->
                </div>
            </div>
        </div>
    </div>
</div>
<div class="pagination-nick"></div>
<!-- 全局js -->
<script src="./static/js/jquery.min.js?v=2.1.4"></script>

<script src="./static/js/bootstrap.min.js?v=3.3.6"></script>
<script src="./static/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
<script src="./static/js/plugins/layer/layer.min.js"></script>

<!-- 自定义js -->
<script type="text/javascript" src="./static/js/contabs.js"></script>

<!-- 第三方插件 -->
<script src="./static/js/plugins/pace/pace.min.js"></script>

<script src="./static/js/layui/layui.all.js"></script>
<script src="./static/js/vue.2.6.11.js"></script>
<script src="./static/js/axios.js"></script>


<script type="text/javascript">
    layui.use(['layer', 'form'], function () {
        var layer = layui.layer
            , form = layui.form;
    });

</script>
<script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>

<script th:inline="javascript">


    const vue = new Vue({
        el: '#app',
        data: {
            user: {},
            projectList: [{
                "cardId": 1,
                "cardType": 0,
                "createUser": 0,
                "level": 0,
                "sex": 0,
                "spendMoney": 0,
                "totalMoney": 10,
                "updateUser": 0,
                "userId": 1
            }],
            arr: [{
                "cardId": 0,
                "idCard": "",
                "phone": "",
                "cardType": "",
                "level": 0
            }],
            // projectTypeList: [],
            level2: "",
            phone2: "",
            sex2: "",
            cardId: ""
        },
        mounted() {
            let me = this;
            $.ajax({
                url: "/user/getUserBySession.do",
                type: "get",
                success: function (data) {
                    me.user = data;
                }
            });
            $.ajax({
                url: "/cardList",
                type: "get",
                success: function (data) {
                    me.projectList = data;
                    //        定义一个分页方法，可多次调用
                    function paginationNick(opt) {
//            参数设置
                        var pager = {
                            paginationBox: '',//分页容器-- 必填
                            mainBox: '',//内容盒子--必填
                            numBtnBox: '',//数字按钮盒子-- 必填
                            btnBox: '',//按钮盒子 --必填
                            ipt: '',//input class-- 必填
                            goBtn: '',//go btn class --必填
                            currentBtn: '',//当前按钮class name --必填
                            pageCount: 5,//每页显示几条数据
                            numBtnCount: 3,//当前页左右两边各多少个数字按钮
                            currentPage: 0,//当前页码data-page，首屏默认值
                            maxCount: 0,//ajax请求数据分成的最大页码
                            data: []//ajax请求的数据
                        };
                        pager = $.extend(pager, opt);

                        //请求数据页面跳转方法
                        goPage =function(btn) {
                            //obj为ajax请求数据
                            var obj = {
                                other: {},
                                value: me.projectList
                            };
                            //将展示的数据赋值给pager.data  (array)
                            pager.data = obj.value;
                            //设置ajax请求数据分成的最大页码
                            pager.maxCount = pager.data.length % pager.pageCount ? parseInt(pager.data.length / pager.pageCount) + 1 :
                                pager.data.length / pager.pageCount;

//                设置当前页码
                            if (!isNaN(btn)) {//数字按钮
                                pager.currentPage = parseInt(btn);
                            } else {
                                switch (btn) {
                                    case 'first':
                                        pager.currentPage = 0;
                                        break;
                                    case 'prev':
                                        if (pager.currentPage > 0) {
                                            --pager.currentPage;
                                        }
                                        break;
                                    case 'next':
                                        if (pager.currentPage + 1 < pager.maxCount) {
                                            ++pager.currentPage;
                                        }
                                        break;
                                    case 'last':
                                        pager.currentPage = pager.maxCount - 1;
                                        break;
                                }
                            }
                            //创建数字按钮
                            createNumBtn(pager.currentPage);
                            //赋值给页码跳转输入框的value，表示当前页码
                            $('.' + pager.btnBox + ' .' + pager.ipt).val(pager.currentPage + 1);
//              内容区填充数据

                            me.arr = pager.data.slice(pager.pageCount * pager.currentPage,
                                pager.data.length - pager.pageCount * (pager.currentPage + 1) > -1 ?
                                    pager.pageCount * (pager.currentPage + 1) : pager.data.length);

                        }


                        //创建非数字按钮和数据内容区
                        createOtherBtn =function () {
                            $('.' + pager.paginationBox).html('<div class="' + pager.btnBox + '"><button data-page="first" class="first-btn">首页</button><button data-page="prev" class="prev-btn">上一页</button><span class="' + pager.numBtnBox + '"></span><button data-page="next" class="next-btn">下一页</button><input type="text" placeholder="请输入页码" class="' + pager.ipt + '"><button class="' + pager.goBtn + '">确定go</button><button data-page="last" class="last-btn">尾页</button></div><div class="' + pager.mainBox + '"></div>');
                            //ipt value变化并赋值给go btn data-page
                            $('.' + pager.btnBox + ' .' + pager.ipt).change(function () {
                                if (!isNaN($(this).val())) {//是数字
                                    if ($(this).val() > pager.maxCount) {//限制value最大值，跳转尾页
                                        $(this).val(pager.maxCount);
                                    }
                                    if ($(this).val() < 1) {//限制value最小值，跳转首页
                                        $(this).val(1);
                                    }
                                } else {//非数字清空value
                                    $(this).val('');
                                }
                                $('.' + pager.btnBox + ' .' + pager.goBtn).attr('data-page', $(this).val() ? $(this).val() - 1 : '');
                            });
                            //每个btn绑定请求数据页面跳转方法
                            $('.' + pager.btnBox + ' button').each(function (i, v) {
                                $(this).click(function () {
                                    //有值且不是上一次的页码时才调用
                                    if (v.getAttribute('data-page') && v.getAttribute('data-page') != pager.currentPage) {
                                        goPage(v.getAttribute('data-page'));
                                    }
                                });
                            });
                        }

                        //创建数字按钮
                        createNumBtn =function (page) {
                            //page是页面index从0开始，这里的page加减一要注意
                            var str = '';
                            if (pager.maxCount > pager.numBtnCount * 2) {//若最大页码数大于等于固定数字按钮总数（pager.numBtnCount*2+1）时
                                //此页左边右边各pager.numBtnCount个数字按钮
                                if (page - pager.numBtnCount > -1) {//此页左边有pager.numBtnCount页 page页码从0开始
                                    for (var m = pager.numBtnCount; m > 0; m--) {
                                        str += '<button data-page="' + (page - m) + '">' + (page - m + 1) + '</button>';
                                    }
                                } else {
                                    for (var k = 0; k < page; k++) {
                                        str += '<button data-page="' + k + '">' + (k + 1) + '</button>';
                                    }
                                }
                                str += '<button data-page="' + page + '" class="' + pager.currentBtn + '" disabled="disabled">' + (page + 1) + '</button>';//此页
                                if (pager.maxCount - page > 3) {//此页右边有pager.numBtnCount页 page页码从0开始
                                    for (var j = 1; j < pager.numBtnCount + 1; j++) {
                                        str += '<button data-page="' + (page + j) + '">' + (page + j + 1) + '</button>';
                                    }
                                } else {
                                    for (var i = page + 1; i < pager.maxCount; i++) {
                                        str += '<button data-page="' + i + '">' + (i + 1) + '</button>';
                                    }
                                }
                                /*数字按钮总数小于固定的数字按钮总数pager.numBtnCount*2+1时，
                         这个分支，可以省略*/
                                if (str.match(/<\/button>/ig).length < pager.numBtnCount * 2 + 1) {
                                    str = '';
                                    if (page < pager.numBtnCount) {//此页左边页码少于固定按钮数时
                                        for (var n = 0; n < page; n++) {//此页左边
                                            str += '<button data-page="' + n + '">' + (n + 1) + '</button>';
                                        }
                                        str += '<button data-page="' + page + '" class="' + pager.currentBtn + '" disabled="disabled">' + (page + 1) + '</button>';//此页
                                        for (var x = 1; x < pager.numBtnCount * 2 + 1 - page; x++) {//此页右边
                                            str += '<button data-page="' + (page + x) + '">' + (page + x + 1) + '</button>';
                                        }
                                    }
                                    if (pager.maxCount - page - 1 < pager.numBtnCount) {
                                        for (var y = pager.numBtnCount * 2 - (pager.maxCount - page - 1); y > 0; y--) {//此页左边
                                            str += '<button data-page="' + (page - y) + '">' + (page - y + 1) + '</button>';
                                        }
                                        str += '<button data-page="' + page + '" class="' + pager.currentBtn + '" disabled="disabled">' + (page + 1) + '</button>';//此页
                                        for (var z = page + 1; z < pager.maxCount; z++) {//此页右边
                                            str += '<button data-page="' + z + '">' + (z + 1) + '</button>';
                                        }
                                    }
                                }
                            } else {
                                str = '';
                                for (var n = 0; n < page; n++) {//此页左边
                                    str += '<button data-page="' + n + '">' + (n + 1) + '</button>';
                                }
                                str += '<button data-page="' + page + '" class="' + pager.currentBtn + '" disabled="disabled">' + (page + 1) + '</button>';//此页
                                for (var x = 1; x < pager.maxCount - page; x++) {//此页右边
                                    str += '<button data-page="' + (page + x) + '">' + (page + x + 1) + '</button>';
                                }
                            }

                            $('.' + pager.numBtnBox).html(str);

                            //每个btn绑定请求数据页面跳转方法
                            $('.' + pager.numBtnBox + ' button').each(function (i, v) {
                                $(this).click(function () {
                                    goPage(v.getAttribute('data-page'));
                                });
                            });

                            //按钮禁用
                            $('.' + pager.btnBox + ' button').not('.' + pager.currentBtn).attr('disabled', false);
                            if (!page) {//首页时
                                $('.' + pager.btnBox + ' .first-btn').attr('disabled', true);
                                $('.' + pager.btnBox + ' .prev-btn').attr('disabled', 'disabled');
                            }
                            if (page == pager.maxCount - 1) {//尾页时
                                $('.' + pager.btnBox + ' .last-btn').attr('disabled', true);
                                $('.' + pager.btnBox + ' .next-btn').attr('disabled', true);
                            }
                        }

                        //首屏加载
                        createOtherBtn();//首屏加载一次非数字按钮即可
                        goPage();//请求数据页面跳转满足条件按钮点击都执行，首屏默认跳转到currentPage
                    }
                    me.arr = pager.data.slice(pager.pageCount * pager.currentPage,
                        pager.data.length - pager.pageCount * (pager.currentPage + 1) > -1 ?
                            pager.pageCount * (pager.currentPage + 1) : pager.data.length);
                }
            });


            //调用
            paginationNick({
                paginationBox: 'pagination-nick',//分页容器--必填
                mainBox: 'main-box-nick',//内容盒子--必填
                numBtnBox: 'num-box-nick',//数字按钮盒子-- 必填
                btnBox: 'btn-box-nick',//按钮盒子 --必填
                ipt: 'page-ipt-nick',//input class-- 必填
                goBtn: 'go-btn-nick',//go btn class --必填
                currentBtn: 'active-nick'//当前按钮class name --必填
            });
        }, methods: {

        }
    })
</script>
</body>
</html>